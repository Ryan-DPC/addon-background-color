name: CI/CD Pipeline
on:
  push:
      branches:
        - main
  pull_request:
      branches:
        - main
jobs:

    build_pack:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout code
          uses: actions/checkout@v4
        - name: Set up Node.js
          uses: actions/setup-node@v4
          with:
            node-version: 20
        - name: Install dependencies
          run: npm i
        - name: Package app (pack:zip)
          run: npm run build:firefox
        - name: Sign with web-ext
          run: |
            npx web-ext sign \
              --api-key ${{ secrets.AMO_JWT_ISSUER }} \
              --api-secret ${{ secrets.AMO_JWT_SECRET }} \
              --channel unlisted \
              --source-dir ./.output/firefox-mv2 \
              --artifacts-dir ./signed
        - name: Upload ZIP (pack:zip)
          uses: actions/upload-artifact@v4
          with:
            name: pack-zip-output
            path: ./.output/extension/*.zip